function getFormattedPartsList() {
  const partsList = document.querySelectorAll("#parts-list .select-row");
  let formattedParts = [];

  partsList.forEach((row) => {
    const part = row.querySelector(".parts-dropdown").value;
    const quantity = row.querySelector(".quantity-dropdown").value;
    if (part && quantity) {
      formattedParts.push(`${part}(${quantity})`);
    }
  });

  return formattedParts.join(", ");
}

function sendDataToJotForm() {
  const modelDropdown = document.getElementById("model-dropdown");
  const selectedModel = modelDropdown.value;
  const formattedPartsList = getFormattedPartsList();

  // Populate hidden fields with data
  document.getElementById("hidden-model").value = selectedModel;
  document.getElementById("hidden-parts").value = formattedPartsList;

  // Send data to parent JotForm
  window.parent.postMessage(
    {
      model_number: selectedModel,
      parts_and_quantities: formattedPartsList,
    },
    "*"
  );
}

// Call sendDataToJotForm before form submission
document.querySelector("form").addEventListener("submit", (e) => {
  e.preventDefault(); // Prevent default to ensure data sends before submission
  sendDataToJotForm();
});
